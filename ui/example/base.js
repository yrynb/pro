!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).conch=e()}(this,(function(){"use strict";return new class{constructor(){const t=this;let e=!1;this.typeMap={default:{render(){const s=(t=>{if(!t)throw new Error("找不到 vue 环境");return e||(t.config.errorHandler=function(t,e,s){console.error(t)},e=!0),t})(t.Vue||window.Vue);this.instance=new s(Object.assign({render:t=>this._getDom(t,this.data,this.opts)},{})).$mount(this.dom),this.dom=this.instance.$el,this.instance.$nextTick((()=>{this.mounted&&this.mounted()}))},update(){this.instance.$forceUpdate()},destroy(){this.instance.$destroy()},resize(t=1020,e=600){if(this.useResizeScale){const s=getComputedStyle(this.parentDom.parentNode);this.parentDom.style.transform=`scale(${Math.min(parseInt(s.width)/t,parseInt(s.height)/e)})`,this.parentDom.style.width=t+"px",this.parentDom.style.height=e+"px"}},setData(e,s){this.data=t.commonMerge(e,this.data),this.instance&&!s&&this._update()},setOption(e,s){this.opts=t.commonMerge(e,this.opts),this.instance&&!s&&this._update()}},echarts:{render(){(this.instance=window.echarts.init(this.dom)).setOption(this.opts),this.mounted&&this.mounted()},update(){this.instance.clear(),this.instance.setOption(this.opts)},destroy(){window.echarts.dispose(this.instance)},resize(){this.instance&&this.instance.resize()},setData(t,e){if(this.instance&&t&&"object"==typeof t){const s=this.opts.series;if(Array.isArray(t)){if(0===t.length)return;let e;t[0].key&&t[0].value?(t=t.filter((t=>t.key&&t.value)),e=(t,e)=>s.find((e=>e.name===t))):e=(t,e)=>s[e],t.forEach((({key:t,value:s},i)=>{const n=e(t,i);n&&(n.data=s)}))}else Object.keys(t).forEach((e=>{const i=s.find((t=>t.name===e));i&&(i.data=t[e])}));e||this._update()}},setOption(t,e){if(!this.instance)return;this.instance.setOption(t,{lazyUpdate:!!e});let s={};Object.entries(this.instance._model._optionManager.mountOption()).forEach((([t,e])=>{if(null!=e){const i=JSON.stringify(e);if("{}"===i||"[]"===i)return;s[t]=e}})),this.opts=s}}},t._events={},this.Base=class{constructor(e,s){for(this.type=this.type||"default","default"===this.type&&(e.parentNode.style.width=e.style.width),this._config=s||{},!t.Vue&&this._config.Vue&&(t.Vue=this._config.Vue);e.hasChildNodes();)e.removeChild(e.firstChild);this.parentDom=e,e.style.transformOrigin="0 0";const i=document.createElement("div");e.appendChild(i),i.style.width="100%",i.style.height="100%",this.dom=i,this._events=t._events,this.__initComp()}setData(t,e){}setOption(t,e){}on(e,s){return(t._events[e]||(t._events[e]=[])).push(s),this}once(t,e){const s=()=>{this.off(t,s),e.apply(this,arguments)};return s.fn=e,this.on(t,s),this}off(e,s){if(!arguments.length)return t._events=Object.create(null),this;const i=t._events[e];if(!i)return this;if(!s)return t._events[e]=null,this;let n,o=i.length;for(;o--;)if(n=i[o],n===s||n.fn===s){i.splice(o,1);break}return this}emit(e,...s){let i=t._events[e];if(i)for(let t=0,e=i.length;t<e;t++){const e=i[t];try{e&&(s?e.apply(this,s):e.call(this))}catch(t){console.error(t)}}return this}}}install(t){this.Vue=t}_richComp(t,{key:e,img:s,script:i,css:n,fonts:o,width:r,height:a}){let h=[];const c=t.prototype;c._getDom=c.render;const d=window.conch;c.__initComp=async function(){const t=this._config.prefix;if(this._registerImg&&this._registerImg(t),s){const e={};Object.entries(s).forEach((([s,i])=>{e[s]=(t||"")+i})),this.img=e}if(o){d.loadFonts(Object.values(o),t);let e={};Object.entries(o).forEach((([t,s])=>{e[t]=s.file})),this.fonts=e}if(n){this.css=n;const e=Object.entries(this.css).filter((([t,e])=>"string"==typeof e));let s=e.shift();for(;s;)d.loadCss(s,t),s=e.shift()}if(i){this.script=i,this._config&&this._config.script&&Object.entries(this._config.script).forEach((([t,e])=>{this.script[t]=e}));const e=Object.entries(this.script).filter((([t,e])=>"string"==typeof e));let s=e.shift();for(;s;)await d.loadScript(s,t),s=e.shift()}this._isLoadingComp=!0,this._rendedComp&&this.render(),h.forEach((t=>t())),h=[]},c._update=async function(){this.instance?(d.typeMap[this.type].update.call(this),this.updated&&this.updated()):(this.created&&this.created(),this.resize(),this._isLoadingComp?(d.typeMap[this.type].render.call(this),this.parentDom.className.includes(e)||(this.parentDom.className+=" "+e)):this._rendedComp=!0)},c.render=function(){return new Promise((t=>{this._isLoadingComp?(this._update(),t()):h.push((()=>{this._update(),t()}))}))};const p=c.destroy;return c.destroy=function(){"function"==typeof p&&p(),d.typeMap[this.type].destroy.call(this)},c.hasOwnProperty("resize")||(c.resize=function(){d.typeMap[this.type].resize.call(this,r,a)}),c.hasOwnProperty("setOption")||(c.setOption=function(){d.typeMap[this.type].setOption.apply(this,arguments)}),c.hasOwnProperty("setData")||(c.setData=function(){d.typeMap[this.type].setData.apply(this,arguments)}),t}register(t,e,s){this[t]=this._richComp(e,s)}loadScript([t,e],s){return new Promise((i=>{let n=window.document.head.querySelector("#"+t);n?n.isLoading?i():n.addEventListener("load",(()=>{i()})):(n=document.createElement("script"),n.src=(s||"")+e,n.type="text/javascript",n.isLoading=!1,n.addEventListener("load",(()=>{n.isLoading=!0,i()})),n.id=t,window.document.head.appendChild(n))}))}loadCss([t,e],s){let i=window.document.head.querySelector("#"+t+"css");if(!i&&["swipermin"].find((e=>e===t))){i=document.createElement("link");let n=e.replace(/\.js/,".css");n=n.replace(/lib/,"css"),window.document.head.appendChild(i),i.href=(s||"")+n,i.rel="stylesheet",i.id=t+"css"}}loadFonts(t,e){return new Promise((async s=>{const i=Array.from(window.document.fonts.values());for(let s=0;s<t.length;s++){const{file:n,psName:o}=t[s];if(i.some((t=>t.family===o)))return;const r=new window.FontFace(o,`url('${e}/fonts/${n}')`);r.load().then((t=>{window.document.fonts.add(t)})),await r.loaded}s()}))}createCss(t,e=""){let s=document.head.querySelector("#styles_comp_global_"+e);s||(s=document.createElement("style"),s.type="text/css",s.id="styles_comp_global_"+e,s.appendChild(document.createTextNode(t)),document.head.appendChild(s)),e||s.appendChild(document.createTextNode(t))}commonMerge(t,e){return typeof t!=typeof e&&console.warn("组件数据类型发生更改可能存在错误"),t&&e&&!Array.isArray(t)&&!Array.isArray(e)&&"object"==typeof t&&"object"==typeof e?Object.assign(e,t):t}}}));